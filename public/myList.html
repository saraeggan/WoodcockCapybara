<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My lists</title>
</head>
<body>

    <h1>My lists</h1>
    <div id="Mylists">

    </div>

    <script>

        let myList = document.getElementById('Mylists');

       async function viewMyLists(){
        const url = "/myLists";

        let credentials = "Bearer " + sessionStorage.getItem("token");
        
        const headers = {
                    "content-type": "application/json",
                    "authorization": credentials
                }

                const cfg = {
                    method: "GET",
                    headers: headers
                }

        let response = await fetch(url, cfg);
        let data = await response.json();
        console.log(data);

        //Lage liste med navn

        let nameList = [];

        for(let item of data){
            if(!nameList.includes(item.listName)){
                nameList.push(item.listName);
            }
            
        }
        for(let i = 0; i < nameList.length; i++){
           let divForList = document.createElement("div");
           divForList.classList.add("divForList");
           myList.appendChild(divForList);
           divForList.innerHTML = 
           `<h3 class="ListName">${nameList[i]}</h3>`;
           for(let item of data){
               if(item.listName === nameList[i]){
                   let babyname = document.createElement("div");
                   babyname.classList.add("babyname");
                   divForList.appendChild(babyname);
                   babyname.innerHTML = item.listItem;
                   //Lage en deletbutton
            deleteButton = document.createElement("button");
            deleteButton.innerHTML = "Delete";
            deleteButton.classList.add("dltBtn");
            babyname.appendChild(deleteButton);

            //eventlistner for remove button

            deleteButton.addEventListener('click', async function (evt) {
                divForList.removeChild(babyname);

                const url = "/deleteItem";

                const body = {
                    listName: item.listName,
                    listItem: item.listItem,
                    share: item.share,
                    id: item.id
                };
            
                let credentials = "Bearer " + sessionStorage.getItem("token");

                const headers = {
                    "content-type": "application/json",
                    "authorization": credentials
                }

                const cfg = {
                    method: "DELETE",
                    body: JSON.stringify(body),
                    headers: headers
                }

                let response = await fetch(url, cfg);

                console.log(response);

            });

               }
           }
          
           
        }
        console.log(nameList);

       }

       viewMyLists();



    </script>
    
</body>
</html>